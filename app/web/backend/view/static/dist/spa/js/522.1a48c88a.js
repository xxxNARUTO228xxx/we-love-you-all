"use strict";(globalThis["webpackChunkwheel_stamp"]=globalThis["webpackChunkwheel_stamp"]||[]).push([[522],{9085:(e,s,t)=>{t.d(s,{h:()=>l});var a=t(2502);t(3681);const l=(0,a.Q_)("main",{state:()=>({errorMessage:"",okMessage:""})})},3629:(e,s,t)=>{t.d(s,{V:()=>r});t(702),t(4641),t(3269);var a=t(2502),l=t(3681),o=t(9085),i=t(2417);let n="";const r=(0,a.Q_)("model",{state:()=>({loading:!1,load_progress:!1,progress:0,stream_loading:!1,stream_status:!1,images:[],video_images:[],download_url:"",client_id:(0,i.createUID)()}),actions:{async stopStreaming(e){const s=(0,o.h)();try{const t={query:e},a=await l.api.get("/model/rtsp_stop",{query:t});let{items:o}=a;this.stream_status=!1,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async downloadImage(e){const s=(0,o.h)();try{const t=await fetch(`${l.API_ROOT}/model/get_image?filename=${e}`,{method:"GET"}),a=await t.blob(),o=URL.createObjectURL(a);return s.errorMessage="",o}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async sendURL(e){console.log(e);const s=(0,o.h)();try{this.stream_loading=!0;const t={rtsp_url:e},a=await l.api.get("/model/rtsp",{query:t});let{items:o}=a;this.stream_status=!0,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async getData(e){const s=(0,o.h)();try{console.log(e),this.loading=!0,this.load_progress=!0;const t=new FormData;t.append("file",e);const a=await fetch(`${l.API_ROOT}/model/archive`,{method:"POST",body:t});if(s.errorMessage="",a.ok){const e=await a.blob(),s=URL.createObjectURL(e);this.download_url=s,this.progress=1,this.load_progress=!1}}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},takeFrame(){if(""!==n&&void 0!==n)return n},async getFrame(e){n=e},async startConsuming(){console.log("start consuming"),this.ws.connection.onmessage=e=>{let s=JSON.parse(e.data),{event:t,data:a}=s;if("new_frame"==t){let e=a;this.getFrame(e)}if("weapon_detect"==t){let e=a;this.video_images.push(e)}if("video_weapon"==t){let e=a;this.loading=!1,this.images.push(e)}if("progress"==t){let e=a;this.progress=e["progress"]}"reload"==t&&location.reload()}},async sendEcho(){this.ws.sendMessage("echo",{msg:"hello"})}}})},4522:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});t(702);var a=t(9835),l=t(6970);const o={class:"container"},i={class:"page-header"},n=["href"],r=(0,a._)("img",{class:"page-header-logo",src:"icons/header-logo.png",width:"50",height:"50",alt:"Логотип FindGun."},null,-1),c=(0,a._)("text",{class:"logo-text"},"FindGun",-1),d=[r,c],g={class:"input-container"},m=["href"],u=["href"],p={class:"main-page"},h=(0,a._)("h1",{class:"visually-hidden"},"Веб-сервис для поиска оружия на видео",-1),_={class:"upload"},w=(0,a._)("h2",{class:"page-title"},"Загрузите видео для поиска оружия",-1),f=(0,a._)("p",{class:"page-subtitle"},"Формат видео должен быть .mp4",-1),b={class:"upload-file__wrapper"},y=(0,a._)("label",{class:"custom-file-input-label",for:"file"},"Выберите файл",-1),k={class:"file-status"},v={class:"upload-button__container container-button"},R={class:"image_board__wrapper"},C={class:"q-pa-md row items-start q-gutter-md"},U=["onClick"],F=(0,a._)("img",{src:"icons/edit.svg",alt:"SVG Icon"},null,-1),I=[F],q={key:0},D={key:0},x=["onClick","src"],O={class:"absolute-bottom text-subtitle1 text-center"},H=(0,a._)("span",null," | ",-1);function L(e,s,t,r,c,F){const L=(0,a.up)("q-linear-progress"),$=(0,a.up)("q-spinner-ball"),M=(0,a.up)("q-inner-loading"),Q=(0,a.up)("q-item-label"),Z=(0,a.up)("q-item-section"),S=(0,a.up)("q-item"),W=(0,a.up)("q-card"),j=(0,a.up)("q-img"),E=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",o,[(0,a._)("header",i,[(0,a._)("a",{class:"page-header-logo-link",href:e.getAttUrl()+"/"},d,8,n),(0,a._)("div",g,[(0,a._)("a",{class:"site-link link-header archive current-link",href:e.getAttUrl()+"/"},"Работа с видео",8,m),(0,a._)("a",{class:"site-link link-header rtsp",href:e.getAttUrl()+"/rtsp"},"Работа с RTSP",8,u)])]),(0,a._)("main",p,[h,(0,a._)("section",_,[w,f,(0,a._)("div",b,[y,(0,a._)("input",{class:"upload-input",type:"file",id:"file",ref:"file",style:{display:"none"},onChange:s[0]||(s[0]=s=>e.handleFileUpload())},null,544),(0,a._)("p",k,(0,l.zw)(e.file_status),1),(0,a._)("div",v,[(0,a.Wm)(L,{stripe:"",color:"dark",size:"10px",value:e.progress,style:{width:"300px"}},null,8,["value"]),(0,a._)("button",{class:"site-button send-button arhive-button",onClick:s[1]||(s[1]=(...s)=>e.uploadFile&&e.uploadFile(...s))},"Отправить видео")])]),(0,a._)("div",R,[(0,a._)("div",C,[(0,a.Wm)(M,{showing:e.loading,style:{position:"absolute"}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{size:"100px",color:"dark"})])),_:1},8,["showing"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.images,(s=>((0,a.wg)(),(0,a.j4)(W,{class:"my-card",key:s.filename},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{class:"title_section"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,null,{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"card-title"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(s.filename)+" ",1),(0,a._)("button",{class:"edit_button",onClick:t=>e.downloadImageInfo(s)},I,8,U)])),_:2},1024),(0,a.Wm)(Q,{caption:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.class,((t,o)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:o},[(0,a._)("span",{class:(0,l.C_)(e.getClass(t))},(0,l.zw)(t),3),o<s.class.length-1?((0,a.wg)(),(0,a.iD)("span",q,", ")):(0,a.kq)("",!0)],64)))),128))])),_:2},1024),(0,a.Wm)(Q,{caption:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.poses,((e,t)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:t},[(0,a._)("span",null,(0,l.zw)(e),1),t<s.poses.length-1?((0,a.wg)(),(0,a.iD)("span",D,", ")):(0,a.kq)("",!0)],64)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,a._)("img",{onClick:t=>e.showDialog(s),src:"data:image/jpeg;base64,"+s.img},null,8,x)])),_:2},1024)))),128))])])])])]),(0,a.Wm)(E,{modelValue:e.dialog,"onUpdate:modelValue":s[2]||(s[2]=s=>e.dialog=s),"auto-close":"","transition-duration":"300",style:{height:"100%",width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{src:e.dialogImgSrc,class:"dialog-image",style:{height:"100%","min-width":"1200px"},fit:"scale-up"},{default:(0,a.w5)((()=>[(0,a._)("div",O,[(0,a.Uk)(" Название: "+(0,l.zw)(e.img_name)+" ",1),H,(0,a.Uk)(" Класс: "+(0,l.zw)(e.img_class),1)])])),_:1},8,["src"])])),_:1},8,["modelValue"])],64)}t(4641),t(3269);var $=t(499),M=t(3629),Q=t(9085),Z=t(2502);const S=(0,a.aZ)({name:"IndexPage",setup(){const e=(0,M.V)(),{images:s,loading:t,load_progress:a,progress:l,download_url:o}=((0,Q.h)(),(0,Z.Jk)(e));let i=(0,$.iH)(null),n=(0,$.iH)(!1),r=(0,$.iH)("Файл не выбран");return{download_url:o,progress:l,load_progress:a,file_status:r,images:s,loading:t,selectedFile:i,store:e,dialog:n,dialogImgSrc:(0,$.iH)(""),img_name:(0,$.iH)(""),img_class:(0,$.iH)("")}},created(){document.title="FindGun | Видео",this.store.startConsuming()},methods:{async downloadImageInfo(e){let s=await this.store.downloadImage(e.filename);const t=e.bboxes.join("\n");let a=new Blob([t],{type:"text/plain"}),l=document.createElement("a"),o=document.createElement("a"),i=window.URL.createObjectURL(a);l.href=s,l.download=e.filename,o.href=i;let n=e.filename.slice(0,-4);o.download=`${n}.txt`,document.body.appendChild(o),o.click(),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o),document.body.removeChild(l)},getClass(e){return"person"===e?"green-text":"weapon"===e?"red-text":""},getAttUrl(){const{protocol:e,hostname:s,port:t,url:a}=window.location;return`${e}//${s}:${t}`},showDialog:function(e){this.error||(this.img_name=e.filename,this.img_class=e.class.join(", "),this.dialogImgSrc="data:image/jpeg;base64,"+e.img,this.dialog=!0)},handleFileUpload(){let e=this.$refs.file;this.selectedFile=this.$refs.file.files[0],e.files.length>0?this.file_status=`${this.selectedFile["name"]}`:this.file_status="Файл не выбран"},async uploadFile(){if(this.images=[],this.progress=0,this.selectedFile){let e=this.selectedFile["name"].slice(-3);"mp4"!==e?(this.selectedFile=null,this.$q.notify({message:"Файл должен быть формата .mp4 !",type:"negative",color:"negative",position:"center",icon:"warning"})):this.store.getData(this.selectedFile)}else this.$q.notify({message:"Выберите файл !",type:"negative",color:"negative",position:"center",icon:"warning"})}},watch:{download_url(e){if(""!=e){console.log("watch",e);const s=document.createElement("a");s.href=e,s.download="video.mp4",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}}});var W=t(1639),j=t(8289),E=t(854),z=t(5304),T=t(4458),A=t(490),P=t(1233),V=t(3115),Y=t(2899),G=t(335),K=t(9984),B=t.n(K);const J=(0,W.Z)(S,[["render",L]]),N=J;B()(S,"components",{QLinearProgress:j.Z,QInnerLoading:E.Z,QSpinnerBall:z.Z,QCard:T.Z,QItem:A.Z,QItemSection:P.Z,QItemLabel:V.Z,QDialog:Y.Z,QImg:G.Z})}}]);