"use strict";(globalThis["webpackChunkwheel_stamp"]=globalThis["webpackChunkwheel_stamp"]||[]).push([[48],{9085:(e,s,t)=>{t.d(s,{h:()=>o});var a=t(2502);t(3681);const o=(0,a.Q_)("main",{state:()=>({errorMessage:"",okMessage:""})})},3629:(e,s,t)=>{t.d(s,{V:()=>l});var a=t(2502),o=t(3681),i=t(9085),r=t(2417);let n="";const l=(0,a.Q_)("model",{state:()=>({loading:!1,load_progress:!1,progress:0,stream_loading:!1,stream_status:!1,images:[],video_images:[],client_id:(0,r.createUID)()}),actions:{async stopStreaming(e){const s=(0,i.h)();try{const t={query:e},a=await o.api.get("/model/rtsp_stop",{query:t});let{items:i}=a;this.stream_status=!1,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async sendURL(e){console.log(e);const s=(0,i.h)();try{this.stream_loading=!0;const t={rtsp_url:e},a=await o.api.get("/model/rtsp",{query:t});let{items:i}=a;this.stream_status=!0,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async getData(e){const s=(0,i.h)();try{console.log(e),this.loading=!0,this.load_progress=!0;const t=new FormData;t.append("file",e);const a=await fetch(`${o.API_ROOT}/model/archive`,{method:"POST",body:t});if(s.errorMessage="",a.ok){const e=await a.json();e.result;this.progress=1,this.load_progress=!1}}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},takeFrame(){if(""!==n&&void 0!==n)return n},async getFrame(e){n=e},async startConsuming(){console.log("start consuming"),this.ws.connection.onmessage=e=>{let s=JSON.parse(e.data),{event:t,data:a}=s;if("new_frame"==t){let e=a;this.getFrame(e)}if("weapon_detect"==t){let e=a;this.video_images.push(e)}if("video_weapon"==t){let e=a;this.loading=!1,this.images.push(e)}if("progress"==t){let e=a;console.log(a),console.log(e["progress"]),this.progress=e["progress"]}"reload"==t&&location.reload()}},async sendEcho(){this.ws.sendMessage("echo",{msg:"hello"})}}})},3048:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Y});t(702);var a=t(9835),o=t(1957),i=t(6970);const r={class:"container"},n={class:"page-header"},l=["href"],c=(0,a._)("img",{class:"page-header-logo",src:"icons/header-logo.png",width:"50",height:"50",alt:"Логотип FindGun."},null,-1),g=(0,a._)("text",{class:"logo-text"},"FindGun",-1),d=[c,g],m={class:"input-container"},u=["href"],p=["href"],h={class:"main-page"},_=(0,a._)("h1",{class:"visually-hidden"},"Веб-сервис для поиска оружия на видео",-1),w={class:"upload"},f=(0,a._)("h2",{class:"page-title"},"Введите ссылку на RTSP поток",-1),y=(0,a._)("p",{class:"page-subtitle"},"Формат: rtsp://user:password@ip/",-1),v={class:"upload-file__wrapper"},k={class:"upload-button__container container-button"},b={class:"video_board__wrapper"},S={class:"image_board__wrapper"},R={class:"q-pa-md row items-start q-gutter-md"},U={key:0},q=["onClick","src"],C=["src"];function D(e,s,t,c,g,D){const I=(0,a.up)("q-spinner-ball"),V=(0,a.up)("q-inner-loading"),H=(0,a.up)("q-item-label"),F=(0,a.up)("q-item-section"),Q=(0,a.up)("q-item"),T=(0,a.up)("q-card"),W=(0,a.up)("q-dialog"),Z=(0,a.up)("q-img");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",r,[(0,a._)("header",n,[(0,a._)("a",{class:"page-header-logo-link",href:e.getAttUrl()+"/"},d,8,l),(0,a._)("div",m,[(0,a._)("a",{class:"site-link link-header archive",href:e.getAttUrl()+"/"},"Работа с архивом",8,u),(0,a._)("a",{class:"site-link link-header rtsp current-link",href:e.getAttUrl()+"/rtsp"},"Работа с RTSP",8,p)])]),(0,a._)("main",h,[_,(0,a._)("section",w,[f,y,(0,a._)("div",v,[(0,a.wy)((0,a._)("input",{class:"url-input",type:"text",placeholder:"Ссылка","onUpdate:modelValue":s[0]||(s[0]=s=>e.rtspUrl=s)},null,512),[[o.nr,e.rtspUrl]]),(0,a._)("div",k,[(0,a._)("button",{class:"site-button send-button",onClick:s[1]||(s[1]=(...s)=>e.stopStream&&e.stopStream(...s))},"Остановить поток"),(0,a._)("button",{class:"site-button send-button",onClick:s[2]||(s[2]=(...s)=>e.sendURL&&e.sendURL(...s))},"Отправить ссылку")])]),(0,a._)("div",b,[(0,a.Wm)(V,{showing:e.stream_loading,style:{position:"absolute"}},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{size:"100px",color:"dark"})])),_:1},8,["showing"]),(0,a._)("img",{onClick:s[3]||(s[3]=s=>e.showDialogVideo()),id:"stream",style:{height:"100%",width:"100%","border-radius":"8px"}})]),(0,a._)("div",S,[(0,a._)("div",R,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.video_images,(s=>((0,a.wg)(),(0,a.j4)(T,{class:"my-card",key:s.filename},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,{class:"card-title"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(s.filename),1)])),_:2},1024),(0,a.Wm)(H,{caption:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.class,((t,o)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:o},[(0,a._)("span",{class:(0,i.C_)(e.getClass(t))},(0,i.zw)(t),3),o<s.class.length-1?((0,a.wg)(),(0,a.iD)("span",U,", ")):(0,a.kq)("",!0)],64)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,a._)("img",{onClick:t=>e.showDialog(s),src:"data:image/jpeg;base64,"+s.img},null,8,q)])),_:2},1024)))),128))])])])])]),(0,a.Wm)(W,{modelValue:e.showStream,"onUpdate:modelValue":s[4]||(s[4]=s=>e.showStream=s),"auto-close":"","transition-duration":"300"},{default:(0,a.w5)((()=>[(0,a._)("section",null,[(0,a._)("img",{src:e.dialogStream,class:"dialog-image",fit:"scale-up"},null,8,C)])])),_:1},8,["modelValue"]),(0,a.Wm)(W,{modelValue:e.dialog,"onUpdate:modelValue":s[5]||(s[5]=s=>e.dialog=s),"auto-close":"","transition-duration":"300"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{src:e.dialogImgSrc,class:"dialog-image",fit:"scale-up"},null,8,["src"])])),_:1},8,["modelValue"])],64)}var I=t(499),V=t(3629),H=t(9085),F=t(2502);const Q=(0,a.aZ)({name:"IndexPage",setup(){const e=(0,V.V)(),{images:s,stream_loading:t,stream_status:a,video_images:o}=((0,H.h)(),(0,F.Jk)(e));let i=(0,I.iH)(!1),r=(0,I.iH)("Файл не выбран"),n=(0,I.iH)(""),l=(0,I.iH)(!1),c=(0,I.iH)(""),g=(0,I.iH)("");return{showStream:l,video_images:o,encode_frame_cam:c,stream_status:a,rtspUrl:n,file_status:r,images:s,stream_loading:t,store:e,dialog:i,dialogStream:g,img_name:(0,I.iH)(""),img_class:(0,I.iH)("")}},created(){document.title="FindGun | RTSP"},methods:{getClass(e){return"person"===e?"green-text":"weapon"===e?"red-text":""},getAttUrl(){const{protocol:e,hostname:s,port:t,url:a}=window.location;return`${e}//${s}:${t}`},getFrame(){setInterval((()=>{let e=this.store.takeFrame();void 0!==e&&""!==e&&(this.encode_frame_cam=e)}),1)},showDialog:function(e){this.error||(this.img_name=e.filename,this.img_class=e.class.join(", "),this.dialogImgSrc="data:image/jpeg;base64,"+e.img,this.dialog=!0)},showDialogVideo:function(){this.error||(this.showStream=!0)},isValidRTSP(e){return e.startsWith("rtsp://")},async sendURL(){this.isValidRTSP(this.rtspUrl)?(this.store.sendURL(this.rtspUrl),this.store.startConsuming(),this.getFrame()):this.$q.notify({message:"Некорректная RTSP-ссылка!",type:"negative",color:"negative",position:"center",icon:"warning"})},async stopStream(){if(0==this.stream_status)this.$q.notify({message:"Поток еще не запущен!",type:"negative",color:"negative",position:"center",icon:"warning"});else{this.store.stopStreaming("stop"),this.stream_status=!1;document.getElementById("stream");this.encode_frame_cam="",this.$q.notify({message:"Поток остановлен!",type:"info",color:"positive",position:"center",icon:"warning"})}}},watch:{encode_frame_cam(e){if(""!==e){let s="data:image/png;base64,"+e,t=document.getElementById("stream");t.src=s,this.dialogStream=s,this.stream_loading=!1}}}});var T=t(1639),W=t(854),Z=t(5304),M=t(4458),P=t(490),x=t(1233),L=t(3115),O=t(2899),$=t(335),E=t(9984),j=t.n(E);const A=(0,T.Z)(Q,[["render",D]]),Y=A;j()(Q,"components",{QInnerLoading:W.Z,QSpinnerBall:Z.Z,QCard:M.Z,QItem:P.Z,QItemSection:x.Z,QItemLabel:L.Z,QDialog:O.Z,QImg:$.Z})}}]);