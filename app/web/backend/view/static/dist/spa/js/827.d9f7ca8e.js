"use strict";(globalThis["webpackChunkwheel_stamp"]=globalThis["webpackChunkwheel_stamp"]||[]).push([[827],{9085:(e,s,t)=>{t.d(s,{h:()=>i});var a=t(2502);t(3681);const i=(0,a.Q_)("main",{state:()=>({errorMessage:"",okMessage:""})})},3629:(e,s,t)=>{t.d(s,{V:()=>r});var a=t(2502),i=t(3681),l=t(9085),o=t(2417);let n="";const r=(0,a.Q_)("model",{state:()=>({loading:!1,load_progress:!1,progress:0,stream_loading:!1,stream_status:!1,images:[],video_images:[],client_id:(0,o.createUID)()}),actions:{async stopStreaming(e){const s=(0,l.h)();try{const t={query:e},a=await i.api.get("/model/rtsp_stop",{query:t});let{items:l}=a;this.stream_status=!1,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async sendURL(e){console.log(e);const s=(0,l.h)();try{this.stream_loading=!0;const t={rtsp_url:e},a=await i.api.get("/model/rtsp",{query:t});let{items:l}=a;this.stream_status=!0,s.errorMessage=""}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},async getData(e){const s=(0,l.h)();try{console.log(e),this.loading=!0,this.load_progress=!0;const t=new FormData;t.append("file",e);const a=await fetch(`${i.API_ROOT}/model/archive`,{method:"POST",body:t});if(s.errorMessage="",a.ok){const e=await a.json();e.result;this.progress=1,this.load_progress=!1}}catch(t){return console.log("ERROR",t),console.dir(t),s.errorMessage=t.message,t}},takeFrame(){if(""!==n&&void 0!==n)return n},async getFrame(e){n=e},async startConsuming(){console.log("start consuming"),this.ws.connection.onmessage=e=>{let s=JSON.parse(e.data),{event:t,data:a}=s;if("new_frame"==t){let e=a;this.getFrame(e)}if("weapon_detect"==t){let e=a;this.video_images.push(e)}if("video_weapon"==t){let e=a;this.loading=!1,this.images.push(e)}if("progress"==t){let e=a;console.log(a),console.log(e["progress"]),this.progress=e["progress"]}"reload"==t&&location.reload()}},async sendEcho(){this.ws.sendMessage("echo",{msg:"hello"})}}})},2827:(e,s,t)=>{t.r(s),t.d(s,{default:()=>G});t(702);var a=t(9835),i=t(6970);const l={class:"container"},o={class:"page-header"},n=["href"],r=(0,a._)("img",{class:"page-header-logo",src:"icons/header-logo.png",width:"50",height:"50",alt:"Логотип FindGun."},null,-1),g=(0,a._)("text",{class:"logo-text"},"FindGun",-1),c=[r,g],d={class:"input-container"},p=["href"],u=["href"],m={class:"main-page"},h=(0,a._)("h1",{class:"visually-hidden"},"Веб-сервис для поиска оружия на видео",-1),_={class:"upload"},f=(0,a._)("h2",{class:"page-title"},"Загрузите архив с видео для поиска оружия (zip)",-1),w=(0,a._)("p",{class:"page-subtitle"},"Формат видео должен быть .mp4, .wmv, .avi",-1),y={class:"upload-file__wrapper"},v=(0,a._)("label",{class:"custom-file-input-label",for:"file"},"Выберите файл",-1),k={class:"file-status"},b={class:"upload-button__container container-button"},F={class:"image_board__wrapper"},q={class:"q-pa-md row items-start q-gutter-md"},C={key:0},D=["onClick","src"],R={class:"absolute-bottom text-subtitle1 text-center"},U=(0,a._)("span",null," | ",-1);function x(e,s,t,r,g,x){const I=(0,a.up)("q-linear-progress"),Q=(0,a.up)("q-spinner-ball"),Z=(0,a.up)("q-inner-loading"),z=(0,a.up)("q-item-label"),H=(0,a.up)("q-item-section"),M=(0,a.up)("q-item"),S=(0,a.up)("q-card"),W=(0,a.up)("q-img"),$=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",l,[(0,a._)("header",o,[(0,a._)("a",{class:"page-header-logo-link",href:e.getAttUrl()+"/"},c,8,n),(0,a._)("div",d,[(0,a._)("a",{class:"site-link link-header archive current-link",href:e.getAttUrl()+"/"},"Работа с архивом",8,p),(0,a._)("a",{class:"site-link link-header rtsp",href:e.getAttUrl()+"/rtsp"},"Работа с RTSP",8,u)])]),(0,a._)("main",m,[h,(0,a._)("section",_,[f,w,(0,a._)("div",y,[v,(0,a._)("input",{class:"upload-input",type:"file",id:"file",ref:"file",style:{display:"none"},onChange:s[0]||(s[0]=s=>e.handleFileUpload())},null,544),(0,a._)("p",k,(0,i.zw)(e.file_status),1),(0,a._)("div",b,[(0,a.Wm)(I,{stripe:"",color:"dark",size:"10px",value:e.progress,style:{width:"300px"}},null,8,["value"]),(0,a._)("button",{class:"site-button send-button arhive-button",onClick:s[1]||(s[1]=(...s)=>e.uploadFile&&e.uploadFile(...s))},"Отправить архив")])]),(0,a._)("div",F,[(0,a._)("div",q,[(0,a.Wm)(Z,{showing:e.loading,style:{position:"absolute"}},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{size:"100px",color:"dark"})])),_:1},8,["showing"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.images,(s=>((0,a.wg)(),(0,a.j4)(S,{class:"my-card",key:s.filename},{default:(0,a.w5)((()=>[(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(z,{class:"card-title"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(s.filename),1)])),_:2},1024),(0,a.Wm)(z,{caption:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.class,((t,l)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:l},[(0,a._)("span",{class:(0,i.C_)(e.getClass(t))},(0,i.zw)(t),3),l<s.class.length-1?((0,a.wg)(),(0,a.iD)("span",C,", ")):(0,a.kq)("",!0)],64)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,a._)("img",{onClick:t=>e.showDialog(s),src:"data:image/jpeg;base64,"+s.img},null,8,D)])),_:2},1024)))),128))])])])])]),(0,a.Wm)($,{modelValue:e.dialog,"onUpdate:modelValue":s[2]||(s[2]=s=>e.dialog=s),"auto-close":"","transition-duration":"300",style:{height:"100%",width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{src:e.dialogImgSrc,class:"dialog-image",style:{height:"100%","min-width":"1200px"},fit:"scale-up"},{default:(0,a.w5)((()=>[(0,a._)("div",R,[(0,a.Uk)(" Название: "+(0,i.zw)(e.img_name)+" ",1),U,(0,a.Uk)(" Класс: "+(0,i.zw)(e.img_class),1)])])),_:1},8,["src"])])),_:1},8,["modelValue"])],64)}var I=t(499),Q=t(3629),Z=t(9085),z=t(2502);const H=(0,a.aZ)({name:"IndexPage",setup(){const e=(0,Q.V)(),{images:s,loading:t,load_progress:a,progress:i}=((0,Z.h)(),(0,z.Jk)(e));let l=(0,I.iH)(null),o=(0,I.iH)(!1),n=(0,I.iH)("Файл не выбран");return{progress:i,load_progress:a,file_status:n,images:s,loading:t,selectedFile:l,store:e,dialog:o,dialogImgSrc:(0,I.iH)(""),img_name:(0,I.iH)(""),img_class:(0,I.iH)("")}},created(){document.title="FindGun | Архив",this.store.startConsuming()},methods:{getClass(e){return"person"===e?"green-text":"weapon"===e?"red-text":""},getAttUrl(){const{protocol:e,hostname:s,port:t,url:a}=window.location;return`${e}//${s}:${t}`},showDialog:function(e){this.error||(this.img_name=e.filename,this.img_class=e.class.join(", "),this.dialogImgSrc="data:image/jpeg;base64,"+e.img,this.dialog=!0)},handleFileUpload(){let e=this.$refs.file;this.selectedFile=this.$refs.file.files[0],e.files.length>0?this.file_status=`${this.selectedFile["name"]}`:this.file_status="Файл не выбран"},async uploadFile(){if(this.images=[],this.progress=0,this.selectedFile){let e=this.selectedFile["name"].slice(-3);"zip"!==e?(this.selectedFile=null,this.$q.notify({message:"Файл должен быть формата .zip !",type:"negative",color:"negative",position:"center",icon:"warning"})):this.store.getData(this.selectedFile)}else this.$q.notify({message:"Выберите файл !",type:"negative",color:"negative",position:"center",icon:"warning"})}},watch:{progress(e){console.log("!!!",e)}}});var M=t(1639),S=t(8289),W=t(854),$=t(5304),O=t(4458),j=t(490),A=t(1233),P=t(3115),T=t(2899),V=t(335),E=t(9984),L=t.n(E);const Y=(0,M.Z)(H,[["render",x]]),G=Y;L()(H,"components",{QLinearProgress:S.Z,QInnerLoading:W.Z,QSpinnerBall:$.Z,QCard:O.Z,QItem:j.Z,QItemSection:A.Z,QItemLabel:P.Z,QDialog:T.Z,QImg:V.Z})}}]);